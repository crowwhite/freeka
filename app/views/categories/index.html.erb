<% if notice %>
  <div><%= notice %></div>
<% end %>
<% if person_logged_in = current_person %>
  <strong><div>currently logged in as <%= person_logged_in.type %> using <%= person_logged_in.email %></div></strong>
<% end %>
<% if !person_signed_in? %>
  <%= link_to 'admin sign up', new_admin_registration_path unless Admin.all.one? %><br>
  <%= link_to 'sign up', new_user_registration_path %>
  <%= link_to 'sign in', new_person_session_path %>
<% else %>
  <%= link_to 'sign out', destroy_person_session_path, method: :delete %>
<% end %>

<h1>Listing categories</h1>
<h3><%= link_to 'Show Sub Categories', categories_path, remote: true %></h3>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Name</th>
      <!-- <th>Parent Category</th> -->
      <th colspan="3"></th>
    </tr>
  </thead>
  <tbody>
    <% @categories.each do |category| %>
      <tr>
        <td><%= category.name %></td>
        <!-- <td><%#= category.parent_category.try(:name) %></td> -->
        <td><%= link_to 'Show', category %></td>
        <% if person_logged_in %>
        <td><%= link_to 'Edit', edit_category_path(category) %></td>
        <!-- <td><%#= link_to 'Destroy', category, method: :delete, data: { confirm: 'Are you sure?' } %></td> -->
        <% if category.enabled %>
          <td><%= link_to 'disable', category_path(category, category: { enabled: false }), method: :put %></td>
        <% else %>
          <td><%= link_to 'enable', category_path(category, category: { enabled: true }), method: :put %></td>
        <% end %>
        <% end %>
      </tr>
      <% if category.sub_categories.count > 0 %>
        <tr class="hiddenn">
          <td colspan = 4>
            <table class="table sub_table">
              <thead>                
                <tr>
                  <th>Sub-Category Name</th>
                  <th colspan="3"></th>
                </tr>
              </thead>
              <tbody>
      <% category.sub_categories.each do |sub_category| %>
                <tr>
                  <td><%= sub_category.name %></td>
                  <!-- <td><%#= category.parent_category.try(:name) %></td> -->
                  <td><%= link_to 'Show', sub_category %></td>
                  <% if person_logged_in %>
                  <td><%= link_to 'Edit', edit_category_path(sub_category) %></td>
                  <!-- <td><%#= link_to 'Destroy', category, method: :delete, data: { confirm: 'Are you sure?' } %></td> -->
                  <% if sub_category.enabled %>
                    <td><%= link_to 'disable', category_path(sub_category, category: { enabled: false }), method: :put %></td>
                  <% else %>
                    <td><%= link_to 'enable', category_path(sub_category, category: { enabled: true }), method: :put %></td>
                  <% end %>
                  <% end %>
                </tr>
      <% end %>
              </tbody>
            </table>
          </td>
        </tr>
      <% end %>

          <%# @category = category %>
          <%# render 'sub_categories' %>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Category', new_category_path %>
