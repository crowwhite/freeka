<% content_for :head do %>
  <%= javascript_include_tag 'sub_region_select' %>
  <%= javascript_include_tag 'sub_category_select' %>
  <% unless @requirement.new_record? %>
    <%= javascript_include_tag 'link' %>
  <% end %>
  <%= javascript_include_tag 'nested_attachment.js' %>
  <%= javascript_include_tag 'remove_link.js' %>
<% end %>
<div class='col-md-2'></div>
<div class="well bs-component col-md-9">
  <%= form_for(@requirement, html: { class: 'form-horizontal', multipart: true }) do |f| %>
  <fieldset>
    <legend>Request</legend>
    <%= render 'shared/errors', locals: { object: @requirement } %>
      <div class="field row form-group">
        <%= f.label 'Category*', for: :category_ids, class: 'col-md-2 control-label' %>
        <div class="col-md-10">
          <%= f.collection_select(:category_ids, Category.roots.enabled, :id, :name, { prompt: 'Select Category' }, { name: 'requirement[category_ids][]', class: 'form-control', data: { url_for_ajax: '/categories/sub_categories' }}) %>
        </div>
      </div>
      <div class="field row form-group">
        <%= f.label :sub_category, class: 'col-md-2 control-label' %>
        <div class="col-md-10">
          <%= render 'categories/sub_categories', locals: { parent_id: f.object.category_ids.first, child_id: f.object.category_ids.last } %>
        </div>
      </div>

      <div class="field row form-group">
        <%= f.label 'title*', class: 'col-md-2 control-label' %>
        <div class="col-md-10">
          <%= f.text_field :title, class: 'form-control', placeholder: "Your request's title.." %>
          (Min 1 and Max 50 characters)
        </div>
      </div>
      <div class="field row form-group">
        <%= f.label 'details*', class: 'col-md-2 control-label' %>
        <div class="col-md-10">
          <%= f.text_area :details, class: 'form-control requirement-detail-box', placeholder: 'Write detailed description of your request...' %>
          (Min 50 characters)
        </div>
      </div>
      <div class="field row form-group">
        <%= f.label 'Require_Before*', for: :expiration_date, class: 'col-md-2 control-label' %>
        <div class="col-md-10">
          <%= f.date_select :expiration_date, class: 'form-control' %>
        </div>
      </div>

      <div class="field row">

          <div class="field row form-group">
            <%= f.label :street, class: 'col-md-2 control-label' %>
            <div class="col-md-10">
              <%= f.text_field :street, class: 'form-control', placeholder: 'Street' %>
            </div>
          </div>

          <div class="field row form-group">
            <%= f.label 'city*', class: 'col-md-2 control-label' %>
            <div class="col-md-10">
              <%= f.text_field :city, class: 'form-control', placeholder: 'City' %>
            </div>  
          </div>

          <div class="field row form-group">
            <%= f.label 'country*', for: :country_code, id: 'country_select_label', class: 'col-md-2 control-label', data: { url_for_ajax: '/addresses/sub_region' } %>
            <div class="col-md-10">
              <%= f.country_select :country_code, priority: %w(IN), prompt: 'Please select a country', id: 'country_select', class: 'form-control' %>
            </div>
          </div>

          <div class="field row form-group">
            <%= f.label 'state*', for: :state_code, class: 'col-md-2 control-label' %>
            <div id="subregion_select" class="col-md-10">
              <%= render partial: 'addresses/sub_region_select', locals: { parent_region: f.object.country_code } %>
            </div>
          </div>

      </div>

      <div class="field row form-group" id='files'>
        <%= f.fields_for :files, (f.object.files if f.object.files.exists?) || f.object.files.build do |a| %>
          <div class="col-md-10 single-file">
            <%= a.label :File, for: :attachment, class: 'col-md-2 control-label' %>
            <div class="col-md-10">
              <div class='row'>
                <div class='col-md-5'>
                  <% unless @requirement.new_record? %>
                    <% if a.object.id %>
                      <text><%= (a.object.caption.blank? ? a.object.attachment_file_name.try(:truncate, 15) : a.object.caption) %></text>
                      <a href="#" class='remove'>
                        <span class='selected remove-text' data-remove='false'>X</span>
                        <span class='hidden remove-text' data-remove='true'>Undo Remove</span>
                      </a>
                      <br><br><br>
                      <%= a.hidden_field :_destroy, class: 'hidden_field' %>
                    <% else %>
                      <%= a.file_field :attachment, class: ' ' %>
                    <% end %>
                  <% else %>
                    <%= a.file_field :attachment, class: ' ' %>
                  <% end %>
                </div>
                <!-- Caption -->
                <%= a.label ' ', class: 'col-md-2 control-label' %>
                <div class='col-md-4'>
                  <%= a.text_field :caption, class: 'form-control', placeholder: :Caption %>
                </div>
                <div class='col-md-1'>
                  <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <div class='row'>
        <div class='col-md-2'></div>
        <div class='col-md-6'>
          (Size of file should not be more than 10 MB, valid types are Image: jpg, jpeg, png, gif and for Documents: pdf, html, doc)
        </div>
        <div class='col-md-4'>
          <%= link_to 'Add files..', '#', class: 'btn btn-primary btn-sm', id: 'add-files' %>
        </div>
      </div>
      <div class="field row form-group">
        <%= f.fields_for :image, f.object.image || f.object.build_image do |a| %>
          <div class="col-md-10">
            <%= a.label :Image, for: :attachment, class: 'col-md-2 control-label' %>
            <div class="col-md-10">
              <%= file_field_tag :attachment, name: 'requirement[image_attributes][attachment]', class: 'form-control' %>
              (Size of the image should be atleast 300*300 and below 700*700)
              <% unless @requirement.new_record? %>
                <br>(Existing Image will be replaced if you select one here)
                &nbsp;&nbsp;<%= image_tag a.object.url(:thumb), class: 'image-preview' %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

      <div class="actions row">
        <div class='col-md-2'></div>
        <div class='col-md-3'>
          <%= f.submit class: 'btn btn-primary'%>
        </div>
          <%= link_to 'Cancel', requirements_path(filter: 'pending'), class: 'btn btn-primary col-md-2' %>
      </div>
    </fieldset>
  <% end %>
</div>