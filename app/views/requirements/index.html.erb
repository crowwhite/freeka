<%= render 'shared/requirement/my_links' %>
<h1>Requirements</h1>
<% if @controller_action == 'requirements#index' %>
  <%= render 'shared/requirement/status_select' %>
<% end %>
<div class="right">
  <%= link_to 'New Requirement', new_requirement_path %>
</div>
<table class="table table-striped">
  <thead>
    <th>Title</th>
    <th>Details</th>
    <th>Expiration Date</th>
    <th>Address</th>
    <th>Categories</th>
    <% if @controller_action == 'welcome#index' %>
      <th>Show Interest</th>
      <th>Share</th>
    <% elsif @controller_action == 'requirements#index' %>
      <th>Status</th>
      <th>Enable/Disable</th>
      <th>Delete</th>
      <th>Donors</th>
      <th></th>
    <% end %>
  </thead>
  <tbody>
    <% @requirements.each do |requirement| %>
      <tr>
        <td><%= link_to requirement.title, requirement %></td>
        <td><%= requirement.details.truncate(30) %></td>
        <td><%= requirement.expiration_date %></td>
        <td>
          <%= requirement.address.street %><br>
          <%= requirement.address.city %><br>
          <% country = Carmen::Country.coded(requirement.address.country_code) %>
          <%= country.subregions.coded(requirement.address.state_code).name %><br>
          <%= country.name %>
        </td>
        <td>
          <%= render 'shared/requirement/categories', locals: { requirement: requirement } %>
        </td>
        <% if @controller_action == 'welcome#index' %>
          <td>
            <%= content_tag :span, id: 'interest' + requirement.id.to_s do %>
              <%= render 'requirements/interest', locals: { requirement: requirement } %>
            <% end %>
          </td>
          <td><%= link_to 'Facebook Share' %></td>
        <% elsif @controller_action == 'requirements#index' %>
          <td><%= requirement.status %></td>
          <%= render 'requirements/state', locals: { requirement: requirement } %>
          <td>
            <% if requirement.pending? %>
              <%= link_to 'delete', requirement, method: :delete, data: { confirm: 'Are you sure?' } %></td>
            <% else %>
              <strong>--</strong>
            <% end %>
          <%= content_tag :td, id: 'donors' do %>
            <%= render 'requirements/donors', locals: { requirement: requirement } %>
          <% end %>
          <%= content_tag :td, id: 'fulfill' + requirement.id.to_s do %>
            <%= render 'requirements/fulfill', locals: { requirement: requirement } %>
          <% end %>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
<%= paginate @requirements %>